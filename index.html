<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Office Check-in/Out</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap");
      body {
        font-family: "Inter", sans-serif;
        background: linear-gradient(-45deg, #1a237e, #2c3e50, #4a148c, #1a237e);
        background-size: 400% 400%;
        animation: gradient-shift 30s ease infinite;
        color: #1f2937;
      }

      @keyframes gradient-shift {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }
    </style>
  </head>
  <body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
    <div
      id="loginPage"
      class="bg-white shadow-xl rounded-2xl w-full max-w-sm p-4 sm:p-8 text-center transition-all duration-300 transform"
    >
      <h1 class="text-3xl font-extrabold text-blue-600 mb-4">Welcome</h1>
      <p class="text-gray-500 mb-6">Please log in to continue.</p>
      <div class="space-y-4">
        <div>
          <label
            for="loginName"
            class="block text-sm font-medium text-gray-700 mb-1 text-left"
            >Your Full Name</label
          >
          <input
            type="text"
            id="loginName"
            class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 transition duration-150"
            placeholder="e.g., Jane Doe"
          />
        </div>
        <div>
          <label
            for="loginRole"
            class="block text-sm font-medium text-gray-700 mb-1 text-left"
            >Your Role</label
          >
          <select
            id="loginRole"
            class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 transition duration-150"
          >
            <option value="Employee">Employee</option>
            <option value="Intern">Intern</option>
          </select>
        </div>
        <button
          id="loginBtn"
          class="w-full py-3 bg-blue-600 text-white font-semibold rounded-xl hover:bg-blue-700 transition transform hover:scale-105 duration-200 shadow-md"
        >
          Log In
        </button>
      </div>
    </div>

    <div
      id="mainApp"
      class="hidden bg-white shadow-xl rounded-2xl w-full max-w-4xl p-4 sm:p-8 space-y-8 transition-all duration-300 transform scale-0"
    >
      <div class="text-center">
        <h1 class="text-4xl font-extrabold text-blue-600 mb-2">
          Office Check-in
        </h1>
        <p class="text-lg text-gray-500">
          Welcome, <span id="welcomeName" class="font-bold"></span>!
        </p>
        <div class="mt-4 text-sm text-gray-400 font-mono select-all">
          Your Session ID:
          <span id="sessionIdDisplay" class="text-gray-600 font-bold"
            >Loading...</span
          >
        </div>
      </div>

      <!-- Check-in Form -->
      <div
        id="checkInForm"
        class="bg-gray-50 p-6 rounded-xl border border-gray-200"
      >
        <button
          id="checkInBtn"
          class="w-full py-3 bg-blue-600 text-white font-semibold rounded-xl hover:bg-blue-700 transition transform hover:scale-105 duration-200 shadow-md"
        >
          Check In
        </button>
      </div>

      <!-- Checked-out Message -->
      <div
        id="checkOutForm"
        class="hidden text-center bg-green-50 p-6 rounded-xl border border-green-200"
      >
        <p class="text-lg text-green-700 font-semibold mb-4">
          You are currently checked in!
        </p>
        <button
          id="checkOutBtn"
          class="w-full py-3 bg-red-600 text-white font-semibold rounded-xl hover:bg-red-700 transition transform hover:scale-105 duration-200 shadow-md"
        >
          Check Out
        </button>
      </div>

      <!-- Real-time Check-in List -->
      <div>
        <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">
          Who's In Today
        </h2>
        <div id="statusMessage" class="text-center text-gray-400 p-6">
          Nobody is checked in yet. Be the first!
        </div>
        <div
          id="inList"
          class="bg-gray-50 p-4 rounded-xl border border-gray-200 grid md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6"
        >
          <!-- User cards will be dynamically added here -->
        </div>
      </div>

      <!-- History Section -->
      <div>
        <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">
          Check-in History
        </h2>
        <div id="historyMessage" class="text-center text-gray-400 p-6">
          No history available.
        </div>
        <div
          id="historyList"
          class="bg-gray-50 p-4 rounded-xl border border-gray-200 space-y-4"
        >
          <!-- History items will be dynamically added here -->
        </div>
      </div>
    </div>

    <!-- Custom Message Modal -->
    <div
      id="messageModal"
      class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50"
    >
      <div class="relative p-8 bg-white w-96 mx-auto rounded-xl shadow-lg">
        <h3 id="modalTitle" class="text-xl font-bold mb-4"></h3>
        <p id="modalMessage" class="text-gray-700 mb-6"></p>
        <div class="text-right">
          <button
            id="modalCloseBtn"
            class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition duration-150"
          >
            OK
          </button>
        </div>
      </div>
    </div>

    <script type="module">
      let sessionId, userName, userRole;

      // Custom Message Box Function
      const showMessage = (title, message) => {
        document.getElementById("modalTitle").innerText = title;
        document.getElementById("modalMessage").innerText = message;
        document.getElementById("messageModal").classList.remove("hidden");
      };

      document.getElementById("modalCloseBtn").onclick = () => {
        document.getElementById("messageModal").classList.add("hidden");
      };

      // --- Page Transition Logic ---
      const showMainApp = () => {
        document.getElementById("loginPage").classList.add("hidden");
        document.getElementById("loginPage").classList.remove("flex");
        document.getElementById("mainApp").classList.remove("hidden");
        document.getElementById("mainApp").classList.remove("scale-0");
      };

      // --- LocalStorage Logic ---
      const getHistory = () => {
        const history = localStorage.getItem("checkinHistory");
        return history ? JSON.parse(history) : [];
      };

      const saveHistory = (history) => {
        localStorage.setItem("checkinHistory", JSON.stringify(history));
      };

      // --- UI Rendering Functions ---
      // Renders the list of currently checked-in users
      const renderCurrentUsers = () => {
        const history = getHistory();
        const inList = document.getElementById("inList");
        const statusMessage = document.getElementById("statusMessage");

        inList.innerHTML = "";

        const checkedInUsers = history.filter((item) => !item.checkOutTime);
        let isUserCheckedIn = false;

        if (sessionId) {
          isUserCheckedIn = checkedInUsers.some(
            (user) => user.sessionId === sessionId
          );
        }

        if (isUserCheckedIn) {
          document.getElementById("checkInForm").classList.add("hidden");
          document.getElementById("checkOutForm").classList.remove("hidden");
        } else {
          document.getElementById("checkInForm").classList.remove("hidden");
          document.getElementById("checkOutForm").classList.add("hidden");
        }

        if (checkedInUsers.length === 0) {
          statusMessage.classList.remove("hidden");
        } else {
          statusMessage.classList.add("hidden");
          checkedInUsers.forEach((user) => {
            const checkInCard = document.createElement("div");
            checkInCard.className = "bg-white p-4 rounded-lg shadow-md";
            const checkInTimeText = user.checkInTime
              ? new Date(user.checkInTime).toLocaleTimeString()
              : "Pending...";
            checkInCard.innerHTML = `
                        <div class="flex items-center space-x-3">
                            <div class="bg-blue-100 text-blue-600 font-bold w-10 h-10 flex items-center justify-center rounded-full text-xl">
                                ${user.name.charAt(0).toUpperCase()}
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-800">${
                                  user.name
                                }</h3>
                                <p class="text-sm text-gray-500">${
                                  user.role
                                }</p>
                            </div>
                        </div>
                        <div class="mt-2 text-xs text-gray-400">
                            Checked In: ${checkInTimeText}
                        </div>
                    `;
            inList.appendChild(checkInCard);
          });
        }
      };

      // Renders the full history log
      const renderHistory = () => {
        const history = getHistory();
        const historyList = document.getElementById("historyList");
        const historyMessage = document.getElementById("historyMessage");

        historyList.innerHTML = "";

        const sortedHistory = [...history].sort(
          (a, b) => new Date(b.checkInTime) - new Date(a.checkInTime)
        );
        if (sortedHistory.length === 0) {
          historyMessage.classList.remove("hidden");
        } else {
          historyMessage.classList.add("hidden");
          sortedHistory.forEach((record) => {
            const historyCard = document.createElement("div");
            historyCard.className =
              "p-4 border border-gray-200 rounded-lg bg-gray-100";
            const checkInTime = record.checkInTime
              ? new Date(record.checkInTime).toLocaleString()
              : "Pending...";
            const checkOutTime = record.checkOutTime
              ? new Date(record.checkOutTime).toLocaleString()
              : "N/A";
            historyCard.innerHTML = `
                        <p class="font-semibold text-gray-800">${record.name} (${record.role})</p>
                        <p class="text-sm text-gray-500">Checked In: ${checkInTime}</p>
                        <p class="text-sm text-gray-500">Checked Out: ${checkOutTime}</p>
                    `;
            historyList.appendChild(historyCard);
          });
        }
      };

      // --- Event Handlers ---
      document.getElementById("loginBtn").addEventListener("click", () => {
        const loginName = document.getElementById("loginName").value.trim();
        const loginRole = document.getElementById("loginRole").value;

        if (!loginName) {
          showMessage(
            "Missing Information",
            "Please enter your name to log in."
          );
          return;
        }

        userName = loginName;
        userRole = loginRole;
        sessionId = crypto.randomUUID(); // Generate a unique session ID
        document.getElementById("welcomeName").innerText = userName;
        document.getElementById("sessionIdDisplay").innerText = sessionId;

        showMainApp();
        renderCurrentUsers();
        renderHistory();
      });

      document.getElementById("checkInBtn").addEventListener("click", () => {
        const history = getHistory();
        const newEntry = {
          sessionId: sessionId,
          name: userName,
          role: userRole,
          checkInTime: new Date().toISOString(),
          checkOutTime: null,
        };
        history.push(newEntry);
        saveHistory(history);
        showMessage("Success!", "Check In Done.");
        renderCurrentUsers();
        renderHistory();
      });

      document.getElementById("checkOutBtn").addEventListener("click", () => {
        const history = getHistory();
        const sessionIndex = history.findIndex(
          (item) => item.sessionId === sessionId
        );

        if (sessionIndex === -1) {
          showMessage(
            "Error",
            "You are not currently checked in or there was an issue finding your session."
          );
          return;
        }

        history[sessionIndex].checkOutTime = new Date().toISOString();
        saveHistory(history);
        showMessage(
          "Success!",
          "You have been successfully checked out. Have a great day!"
        );
        renderCurrentUsers();
        renderHistory();
      });

      // Initial UI update on page load
      window.onload = () => {
        renderCurrentUsers();
        renderHistory();
      };
    </script>
  </body>
</html>
